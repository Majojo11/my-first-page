<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Eventos</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-screen bg-gray-50 flex text-gray-700">

<!-- Sidebar -->
<aside class="w-64 bg-gray-100 h-full flex flex-col p-4 border-r border-gray-200">
    <input type="text" placeholder="Buscar" class="mb-4 bg-gray-200 rounded-lg px-3 py-2 outline-none text-sm placeholder-gray-500">

    <div class="grid grid-cols-2 gap-3 mb-6">
        <button class="bg-gray-200 rounded-xl py-4 flex flex-col items-center justify-center text-sm font-medium hover:bg-gray-300 transition">
            <span class="text-2xl">ðŸ‘¤</span> Mi perfil
        </button>
        <button class="bg-gray-200 rounded-xl py-4 flex flex-col items-center justify-center text-sm font-medium hover:bg-gray-300 transition">
            <span class="text-2xl">ðŸ“…</span> Todos los eventos
        </button>
        <button class="bg-gray-200 rounded-xl py-4 flex flex-col items-center justify-center text-sm font-medium hover:bg-gray-300 transition">
            <span class="text-2xl">ðŸ‘¥</span> Amigos
        </button>
        <button class="bg-gray-200 rounded-xl py-4 flex flex-col items-center justify-center text-sm font-medium hover:bg-gray-300 transition">
            <span class="text-2xl">ðŸ“Š</span> EstadÃ­sticas
        </button>
    </div>

    <h3 class="font-semibold text-sm mb-2">Eventos</h3>
    <div class="flex justify-between items-center mb-3">
        <p class="text-sm text-gray-500 italic">Nuevo evento...</p>
        <div class="flex space-x-2">
            <button id="deleteEventBtn" class="font-bold px-2 py-1">-</button>
            <button id="newEventBtn" class="text-lg font-bold px-2 py-1">+</button>
        </div>
    </div>

    <ul id="eventList" class="text-sm space-y-2">
        <!-- Eventos aquÃ­ -->
    </ul>
</aside>

<!-- Main content -->
<main class="flex-1 flex flex-col p-10 relative">
    <div class="flex justify-between items-center mb-8">
        <h1 id="eventTitle" class="text-3xl font-extrabold">Selecciona un evento</h1>
        <button id="addExpenseBtn" class="bg-gray-300 hover:bg-gray-400 w-10 h-10 rounded-full flex items-center justify-center text-2xl transition hidden">+</button>
    </div>

    <div id="expensesList" class="space-y-8"></div>

    <button id="generateReport" class="mt-auto bg-gray-300 text-gray-500 font-semibold py-3 rounded-xl hover:bg-gray-400 hover:text-gray-700 transition hidden">
        Generar reporte
    </button>
</main>

<!-- Modal para crear evento -->
<div id="eventModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-60 flex items-center justify-center z-50">
    <div class="bg-gray-100 rounded-xl shadow-lg w-1/2 p-8 relative">
        <button id="closeModal" class="absolute top-4 right-4 text-2xl text-gray-600 hover:text-black">âœ•</button>
        <h2 class="text-2xl font-bold mb-6">Nuevo Evento</h2>

        <form id="eventForm" class="space-y-4">
            <div>
                <label class="block font-semibold text-gray-600 mb-1">Nombre de evento</label>
                <input type="text" id="eventName" class="w-full bg-gray-300 rounded-lg px-3 py-2 outline-none">
            </div>
            <div>
                <label class="block font-semibold text-gray-600 mb-1">DescripciÃ³n</label>
                <input type="text" id="eventDesc" class="w-full bg-gray-300 rounded-lg px-3 py-2 outline-none">
            </div>
            <div>
                <label class="block font-semibold text-gray-600 mb-1">Usuarios</label>
                <input type="text" id="eventUsers" placeholder="Ej: Juan, Ana, Pedro" class="w-full bg-gray-300 rounded-lg px-3 py-2 outline-none">
            </div>

            <div class="flex justify-end mt-6">
                <button type="submit" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition">Crear Evento</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de gasto -->
<div id="modalExpense" class="hidden fixed inset-0 bg-gray-800 bg-opacity-60 flex items-center justify-center z-50">
    <div class="bg-gray-200 rounded-lg shadow-lg p-8 w-1/3 relative">
        <button id="closeExpense" class="absolute top-4 right-4 text-2xl text-gray-600 hover:text-black">âœ•</button>
        <h2 class="font-bold text-gray-800 mb-4">Nuevo gasto</h2>

        <form id="expenseForm" class="space-y-4">
            <div>
                <label class="block font-semibold text-gray-600 mb-1">Nombre del gasto</label>
                <input type="text" id="expenseName" class="w-full bg-gray-300 rounded-lg px-3 py-2 outline-none">
            </div>
            <div>
                <label class="block font-semibold text-gray-600 mb-1">Monto total</label>
                <input type="number" id="expenseAmount" class="w-full bg-gray-300 rounded-lg px-3 py-2 outline-none" min="0">
            </div>
            <div>
                <label class="block font-semibold text-gray-600 mb-2">Selecciona quiÃ©nes participan</label>
                <div id="userCheckboxes" class="space-y-2"></div>
            </div>

            <div class="flex justify-end mt-6">
                <button type="submit" class="bg-gray-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-gray-600 transition">Agregar gasto</button>
            </div>
        </form>
    </div>
</div>


<script>
    let eventos = [];
    let eventoActual = null;

    const newEventBtn = document.getElementById("newEventBtn");
    const eventModal = document.getElementById("eventModal");
    const closeModal = document.getElementById("closeModal");
    const eventForm = document.getElementById("eventForm");
    const eventList = document.getElementById("eventList");

    const addExpenseBtn = document.getElementById("addExpenseBtn");
    const modalExpense = document.getElementById("modalExpense");
    const closeExpense = document.getElementById("closeExpense");
    const expenseForm = document.getElementById("expenseForm");
    const userCheckboxes = document.getElementById("userCheckboxes");

    const expensesList = document.getElementById("expensesList");
    const eventTitle = document.getElementById("eventTitle");
    const reportBtn = document.getElementById("generateReport");

    // Abrir modal nuevo evento
    newEventBtn.addEventListener("click", () => eventModal.classList.remove("hidden"));
    closeModal.addEventListener("click", () => eventModal.classList.add("hidden"));

    // Crear evento
    eventForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const name = eventName.value.trim();
        const desc = eventDesc.value.trim();
        const users = eventUsers.value.split(",").map(u => u.trim()).filter(u => u !== "");

        if (!name || users.length === 0) {
            alert("Debes ingresar un nombre y al menos un usuario.");
            return;
        }

        const newEvent = { name, desc, users, expenses: [] };
        eventos.push(newEvent);

        const li = document.createElement("li");
        li.textContent = name;
        li.className = "cursor-pointer hover:text-black text-gray-500";
        li.addEventListener("click", () => abrirEvento(newEvent));
        eventList.appendChild(li);

        eventModal.classList.add("hidden");
        eventForm.reset();
    });

    function abrirEvento(evento) {
        eventoActual = evento;
        eventTitle.textContent = evento.name;
        addExpenseBtn.classList.remove("hidden");
        reportBtn.classList.remove("hidden");
        mostrarGastos();
    }

    // Abrir modal de gasto
    addExpenseBtn.addEventListener("click", () => {
        if (!eventoActual) return;
        userCheckboxes.innerHTML = "";
        eventoActual.users.forEach(user => {
            const div = document.createElement("div");
            div.innerHTML = `
                <label class="flex items-center space-x-2">
                    <input type="checkbox" value="${user}" class="accent-gray-500" />
                    <span>${user}</span>
                </label>`;
            userCheckboxes.appendChild(div);
        });
        modalExpense.classList.remove("hidden");
    });

    // Cerrar modal de gasto
    closeExpense.addEventListener("click", () => modalExpense.classList.add("hidden"));

    // Agregar gasto
    expenseForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const nombre = expenseName.value.trim();
        const monto = parseFloat(expenseAmount.value);
        const seleccionados = Array.from(userCheckboxes.querySelectorAll("input:checked")).map(c => c.value);

        if (!nombre || isNaN(monto) || seleccionados.length === 0) {
            alert("Completa todos los campos y selecciona al menos un usuario.");
            return;
        }

        const montoPorPersona = monto / seleccionados.length;
        const nuevoGasto = { nombre, monto, seleccionados, montoPorPersona };

        eventoActual.expenses.push(nuevoGasto);
        mostrarGastos();

        modalExpense.classList.add("hidden");
        expenseForm.reset();
    });

    function mostrarGastos() {
        expensesList.innerHTML = "";
        eventoActual.expenses.forEach(g => {
            const div = document.createElement("div");
            div.innerHTML = `
                <h3 class="font-bold text-lg mb-2">â€¢ ${g.nombre} - <span class="font-bold">$${g.monto.toFixed(2)}</span></h3>
                <ul class="ml-6 text-sm text-gray-500">
                    ${g.seleccionados.map(u => `<li class="flex justify-between"><span>${u}</span><span>$${g.montoPorPersona.toFixed(2)}</span></li>`).join("")}
                </ul>`;
            expensesList.appendChild(div);
        });
    }
</script>

</body>
</html>
